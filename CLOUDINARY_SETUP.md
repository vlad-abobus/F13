# üñºÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Cloudinary –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–æ–±—Ä–∞–∂–µ–Ω—å

## –û–≥–ª—è–¥

–ü—Ä–æ—î–∫—Ç –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **Cloudinary** —è–∫ —î–¥–∏–Ω–µ —Å—Ö–æ–≤–∏—â–µ –º–µ–¥—ñ–∞ –¥–ª—è –∑–æ–±—Ä–∞–∂–µ–Ω—å. –ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ Cloudinary, –∞ –≤ PostgreSQL –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –º–µ—Ç–∞–¥–∞–Ω—ñ:
- `secure_url` - HTTPS URL –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
- `public_id` - —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –≤ Cloudinary
- `created_at` - —á–∞—Å —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–ø–∏—Å—É

## –ö—Ä–æ–∫ 1: –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –≤ Cloudinary

1. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –Ω–∞ [cloudinary.com](https://cloudinary.com)
2. –°—Ç–≤–æ—Ä—ñ—Ç—å –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏–π –∞–∫–∞—É–Ω—Ç
3. –ü—ñ—Å–ª—è —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó –≤–∏ –æ—Ç—Ä–∏–º–∞—î—Ç–µ:
   - **Cloud Name**
   - **API Key**
   - **API Secret**

## –ö—Ä–æ–∫ 2: –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω–Ω–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞

–î–æ–¥–∞–π—Ç–µ –¥–æ –≤–∞—à–æ–≥–æ `.env` —Ñ–∞–π–ª—É **–æ–¥–∏–Ω –∑ –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤**:

### –í–∞—Ä—ñ–∞–Ω—Ç 1: CLOUDINARY_URL (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)

```env
# Cloudinary Configuration (—Ñ–æ—Ä–º–∞—Ç: cloudinary://api_key:api_secret@cloud_name)
CLOUDINARY_URL=cloudinary://611816614459766:3NXrtSungCqabGyuxUGQEMBCa1Q@dsxjikvnm
```

**–ü—Ä–∏–º—ñ—Ç–∫–∞:** –ó–∞–º—ñ–Ω—ñ—Ç—å `dsxjikvnm` –Ω–∞ –≤–∞—à Cloud Name –∑ Cloudinary Dashboard.

### –í–∞—Ä—ñ–∞–Ω—Ç 2: –û–∫—Ä–µ–º—ñ –∑–º—ñ–Ω–Ω—ñ (–¥–ª—è –∑–≤–æ—Ä–æ—Ç–Ω–æ—ó —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ)

```env
# Cloudinary Configuration
CLOUDINARY_CLOUD_NAME=dsxjikvnm
CLOUDINARY_API_KEY=611816614459766
CLOUDINARY_API_SECRET=3NXrtSungCqabGyuxUGQEMBCa1Q
```

**–í–∞—à—ñ –¥–∞–Ω—ñ:**
- API Key: `611816614459766`
- API Secret: `3NXrtSungCqabGyuxUGQEMBCa1Q`
- Cloud Name: `dsxjikvnm` (–æ—Ç—Ä–∏–º–∞–π—Ç–µ –∑ –≤–∞—à–æ–≥–æ Cloudinary Dashboard)

**–ü—Ä–∏–º—ñ—Ç–∫–∞:** –Ø–∫—â–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –æ–±–∏–¥–≤–∞ –≤–∞—Ä—ñ–∞–Ω—Ç–∏, `CLOUDINARY_URL` –º–∞—î –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç.

## –ö—Ä–æ–∫ 3: –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

–¶–µ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `cloudinary==1.41.0`.

## –ö—Ä–æ–∫ 4: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—ñ –≤ –ë–î

**–¢–∞–±–ª–∏—Ü—è `images` —Å—Ç–≤–æ—Ä–∏—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ** –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É –¥–æ–¥–∞—Ç–∫—É —á–µ—Ä–µ–∑ `init_db()` (–≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤ `app/__init__.py`).

**–ù–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ Flask-Migrate** - –ø—Ä–æ—î–∫—Ç –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `db.create_all()` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—å.

–Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –≤—Ä—É—á–Ω—É —á–µ—Ä–µ–∑ SQL:

```sql
CREATE TABLE images (
  id SERIAL PRIMARY KEY,
  url TEXT NOT NULL,
  public_id TEXT NOT NULL UNIQUE,
  created_at TIMESTAMP DEFAULT NOW()
);
```

**–ê–±–æ –ø—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç—ñ—Ç—å –¥–æ–¥–∞—Ç–æ–∫** - —Ç–∞–±–ª–∏—Ü—è —Å—Ç–≤–æ—Ä–∏—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ:
```bash
python run.py
```

## –ö—Ä–æ–∫ 5: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–±–æ—Ç–∏

1. –ó–∞–ø—É—Å—Ç—ñ—Ç—å –¥–æ–¥–∞—Ç–æ–∫:
   ```bash
   python run.py
   ```

2. –°–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è —á–µ—Ä–µ–∑:
   - –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–æ—Å—Ç–∞ –∑ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è–º
   - –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∞–≤–∞—Ç–∞—Ä–∞ –≤ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è—Ö –ø—Ä–æ—Ñ—ñ–ª—é

3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –≤ Cloudinary Dashboard, —â–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∑'—è–≤–∏–ª–∏—Å—è –≤ –ø–∞–ø—Ü—ñ `freedom13/`

## API Endpoint

### POST `/api/upload`

**–ê–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è:** –ü–æ—Ç—Ä—ñ–±–Ω–∞ (Bearer token)

**Request:**
- Content-Type: `multipart/form-data`
- Body: `file` (image file)

**Response (—É—Å–ø—ñ—Ö):**
```json
{
  "secure_url": "https://res.cloudinary.com/.../image.jpg",
  "public_id": "freedom13/image_abc123",
  "id": 1,
  "created_at": "2024-01-01T12:00:00"
}
```

**Response (–ø–æ–º–∏–ª–∫–∞):**
```json
{
  "error": "Error message"
}
```

## –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

### Backend (`app/routes/upload.py`)
- –í–∞–ª—ñ–¥–∞—Ü—ñ—è —Ñ–∞–π–ª—É (—Ç–∏–ø, —Ä–æ–∑–º—ñ—Ä)
- –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤ Cloudinary
- –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –º–µ—Ç–∞–¥–∞–Ω–∏—Ö –≤ PostgreSQL

### Frontend
- `PostForm.tsx` - –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–æ–±—Ä–∞–∂–µ–Ω—å –¥–ª—è –ø–æ—Å—Ç—ñ–≤
- `ProfileSettings.tsx` - –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∞–≤–∞—Ç–∞—Ä–∞

### –ú–æ–¥–µ–ª—å (`app/models/image.py`)
```python
class Image:
    id: int
    url: str  # secure_url –∑ Cloudinary
    public_id: str  # —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä
    created_at: datetime
```

## –í–∞–∂–ª–∏–≤–æ

‚úÖ **–ó–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ PostgreSQL:** –¢—ñ–ª—å–∫–∏ –º–µ—Ç–∞–¥–∞–Ω—ñ (URL, public_id)  
‚úÖ **–ó–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ Cloudinary:** –°–∞–º–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è  
‚ùå **–ù–ï –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è:** –ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ª–æ–∫–∞–ª—å–Ω–æ –∞–±–æ –≤ –ë–î —è–∫ BLOB

## Rate Limiting

Endpoint `/api/upload` –º–∞—î rate limit: **10 –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—å –Ω–∞ —Ö–≤–∏–ª–∏–Ω—É** –Ω–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.

## –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫

- –í–∞–ª—ñ–¥–∞—Ü—ñ—è —Ç–∏–ø—É —Ñ–∞–π–ª—É (png, jpg, jpeg, gif, webp)
- –í–∞–ª—ñ–¥–∞—Ü—ñ—è —Ä–æ–∑–º—ñ—Ä—É (–º–∞–∫—Å–∏–º—É–º 5MB –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º)
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ Cloudinary –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó
- –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫ Cloudinary —Ç–∞ –ë–î

## –ú—ñ–≥—Ä–∞—Ü—ñ—è –∑—ñ —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–¥—É

–°—Ç–∞—Ä–∏–π –∫–æ–¥ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤–∏–¥–∞–ª–µ–Ω–æ:
- ‚ùå `/api/posts/upload` (–ª–æ–∫–∞–ª—å–Ω–µ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è)
- ‚ùå `/api/users/profile/avatar` (–ª–æ–∫–∞–ª—å–Ω–µ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è)

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –Ω–æ–≤–∏–π endpoint `/api/upload` –¥–ª—è –≤—Å—ñ—Ö –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—å.
