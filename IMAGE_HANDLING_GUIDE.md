# üñºÔ∏è Image Handling Guide

## –û–≥–ª—è–¥

–†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –∫–æ–º–ø–ª–µ–∫—Å–Ω–µ —Ä—ñ—à–µ–Ω–Ω—è –¥–ª—è –æ–±—Ä–æ–±–∫–∏ –≤—ñ–¥—Å—É—Ç–Ω—ñ—Ö –∞–±–æ –Ω–µ–≤–∞–ª—ñ–¥–Ω–∏—Ö –∑–æ–±—Ä–∞–∂–µ–Ω—å —É –¥–æ–¥–∞—Ç–∫—É Freedom13.

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ —Ä—ñ—à–µ–Ω–Ω—è

### 1. **SafeImage Component** (`client/src/components/SafeImage.tsx`)

–†–µ–∞–∫—Ç–∏–≤–Ω–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, —è–∫–∏–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–±—Ä–æ–±–ª—è—î:
- `NULL` –∞–±–æ `undefined` –∑–Ω–∞—á–µ–Ω–Ω—è –∑ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
- –ü–æ—Ä–æ–∂–Ω—ñ —Ä—è–¥–∫–∏ (`''`)
- –ü–æ–º–∏–ª–∫–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è (404, broken links)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –Ω–∞ placeholder

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:**
```tsx
import SafeImage from '../components/SafeImage'

// –ü—Ä–æ—Å—Ç–∏–π –≤–∏–ø–∞–¥–æ–∫
<SafeImage 
  src={user.avatar_url} 
  alt="User avatar" 
  className="w-32 h-32 rounded-full"
/>

// –ó –∫–∞—Å—Ç–æ–º–Ω–∏–º fallback
<SafeImage 
  src={post.image_url} 
  alt="Post image"
  className="w-full"
  fallback={
    <div className="bg-gray-800 p-4">
      <span>No image available</span>
    </div>
  }
/>
```

### 2. **Database Migration**

#### SQL —Å–∫—Ä–∏–ø—Ç (`migrations/fix_image_urls.sql`)
–û—á–∏—â–∞—î —ñ—Å–Ω—É—é—á—ñ –Ω–µ–≤–∞–ª—ñ–¥–Ω—ñ URL –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö:
- –í—Å—Ç–∞–Ω–æ–≤–ª—é—î `NULL` –¥–ª—è –ø–æ—Ä–æ–∂–Ω—ñ—Ö —Ä—è–¥–∫—ñ–≤
- –í—Å—Ç–∞–Ω–æ–≤–ª—é—î `NULL` –¥–ª—è —Ä—è–¥–∫—ñ–≤ 'null', 'NULL', 'undefined'
- –ü—Ä–∞—Ü—é—î –∑ —Ç–∞–±–ª–∏—Ü—è–º–∏: `posts`, `users`, `profile_posts`

#### Python —Å–∫—Ä–∏–ø—Ç (`app/scripts/fix_image_urls.py`)
–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∏–π —Å–ø–æ—Å—ñ–± –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –º—ñ–≥—Ä–∞—Ü—ñ—ó —á–µ—Ä–µ–∑ SQLAlchemy:
```bash
python -m app.scripts.fix_image_urls
```

### 3. **Placeholder Image**

–°—Ç–≤–æ—Ä–µ–Ω–æ SVG placeholder (`client/public/assets/placeholder.svg`), —è–∫–∏–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º.

## –û–Ω–æ–≤–ª–µ–Ω—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏

–í—Å—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏, —â–æ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è, –æ–Ω–æ–≤–ª–µ–Ω—ñ –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `SafeImage`:

- ‚úÖ `PostCard.tsx` - –ø–æ—Å—Ç–∏ —Ç–∞ –∞–≤–∞—Ç–∞—Ä–∏ –∞–≤—Ç–æ—Ä—ñ–≤
- ‚úÖ `Profile.tsx` - –∞–≤–∞—Ç–∞—Ä–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Ç–∞ —Å—Ç—ñ–Ω–∞ –ø—Ä–æ—Ñ—ñ–ª—é
- ‚úÖ `CommentSection.tsx` - –∞–≤–∞—Ç–∞—Ä–∏ –≤ –∫–æ–º–µ–Ω—Ç–∞—Ä—è—Ö
- ‚úÖ `Gallery.tsx` - –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≤ –≥–∞–ª–µ—Ä–µ—ó
- ‚úÖ `ProfileSettings.tsx` - –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥ –∞–≤–∞—Ç–∞—Ä–∞

## Backend

Backend –≤–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–≤–µ—Ä—Ç–∞—î –∑–Ω–∞—á–µ–Ω–Ω—è –∑ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö:
- –Ø–∫—â–æ `image_url` = `NULL` –≤ –ë–î ‚Üí –ø–æ–≤–µ—Ä—Ç–∞—î `null` –≤ JSON
- –Ø–∫—â–æ `image_url` = –≤–∞–ª—ñ–¥–Ω–∏–π URL ‚Üí –ø–æ–≤–µ—Ä—Ç–∞—î URL
- Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `SafeImage` –æ–±—Ä–æ–±–ª—è—î –æ–±–∏–¥–≤–∞ –≤–∏–ø–∞–¥–∫–∏

## –Ø–∫ –≤–∏–∫–æ–Ω–∞—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ—é

### –í–∞—Ä—ñ–∞–Ω—Ç 1: Python —Å–∫—Ä–∏–ø—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)
```bash
python -m app.scripts.fix_image_urls
```

### –í–∞—Ä—ñ–∞–Ω—Ç 2: SQL —Å–∫—Ä–∏–ø—Ç
```bash
# PostgreSQL
psql -U your_user -d freedom13 -f migrations/fix_image_urls.sql
```

## –ü–µ—Ä–µ–≤–∞–≥–∏ —Ä—ñ—à–µ–Ω–Ω—è

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –æ–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫** - –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤—Ä—É—á–Ω—É –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ –∫–æ–∂–Ω–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
2. **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∏–π UX** - –∑–∞–≤–∂–¥–∏ –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è placeholder –∑–∞–º—ñ—Å—Ç—å broken icons
3. **–ì–Ω—É—á–∫—ñ—Å—Ç—å** - –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∫–∞—Å—Ç–æ–º–Ω—ñ fallback –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏
4. **–ë–µ–∑–ø–µ–∫–∞** - –º—ñ–≥—Ä–∞—Ü—ñ—è –Ω–µ –≤–∏–¥–∞–ª—è—î –¥–∞–Ω—ñ, —Ç—ñ–ª—å–∫–∏ –æ—á–∏—â–∞—î –Ω–µ–≤–∞–ª—ñ–¥–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è
5. **Idempotent** - –º—ñ–≥—Ä–∞—Ü—ñ—é –º–æ–∂–Ω–∞ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –∫—ñ–ª—å–∫–∞ —Ä–∞–∑—ñ–≤ –±–µ–∑–ø–µ—á–Ω–æ

## –¢–µ—Ö–Ω—ñ—á–Ω—ñ –¥–µ—Ç–∞–ª—ñ

- **–¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó**: React, TypeScript, SQLAlchemy, PostgreSQL/SQLite
- **–ü—ñ–¥—Ö—ñ–¥**: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–∏–π, –∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ—é –æ–±—Ä–æ–±–∫–æ—é –ø–æ–º–∏–ª–æ–∫
- **–°—É–º—ñ—Å–Ω—ñ—Å—Ç—å**: –ü—Ä–∞—Ü—é—î –∑ —ñ—Å–Ω—É—é—á–∏–º –∫–æ–¥–æ–º –±–µ–∑ breaking changes
